@page
@model ScheduleModel
@{
    ViewData["Title"] = "Schedule page";
}

@* Modal asking the user to login *@
@if (TempData["login"] != null)
{
    <div class="modal-container d-flex justify-content-center align-items-center login-row">
        <div class="card text-dark p-4 modal-pop">
            <p>You need to login as an admin</p>
            <a class="btn btn-success" asp-page="/Login">login</a>
            <a class="nav-link text-primary mt-3" asp-page="/Index"><i class="bi bi-arrow-left"></i> Home</a>
        </div>
    </div>
}

@* Pop-up msg for a successful schedule clearance*@
@if (TempData["success"] != null)
{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script type="text/javascript">
        toastr.success('@TempData["success"]');
    </script>
}


<div class="row d-flex justify-content-center">

    <div class="col-12 col-md-8">
        <h1 class="display-4 text-center status-th">Schedule</h1>
        <p class="text-center">Weekly Waiter's Shifts</p>

        @* Select the table or board view*@
        <div class="dropdown mb-3">
            <button class="btn btn-secondary dropdown-toggle view-btn" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                View
            </button>

            <form method="post">
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <button class="dropdown-item" asp-page-handler="Table">Table</button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" asp-page-handler="Board">Board</button>
                </div>
            </form>
        </div>

        @if(Model.View == "Board")
        {
            <table class="table w-50 table-bordered bg-light rounded">
                <thead>
                    <tr class="text-center">
                        <th style="width: 50%;"><i class="bi bi-calendar-event-fill"></i></th>
                        <th style="width: 50%;"><i class="bi bi-person-badge-fill"></i></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var day in Model.weekdays)
                    {
                        <tr class="border-top">
                            <td class="bg-light text-center">
                                <h5 class="status-th">@day</h5>
                            </td>
                            @foreach (var group in Model.Schedule)
                            {
                                if (@group.Key == day)
                                {
                                    <td class="text-center">
                                    @foreach (var waiter in group)
                                    {
                                            <form asp-page-handler="account" method="post">
                                                <button class="btn-waiter name-color">@waiter.FirstName</button>
                                                <input type="hidden" name="name" value="@waiter.FirstName">
                                            </form>
                                    }
                                    </td>
                                }
                            }
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <table class="table table-borderless bg-light rounded">
                <thead>
                    <tr class="text-center">
                        <th style="width: 25%;"><i class="bi bi-calendar-event-fill"></i></th>
                        <th style="width: 25%;"><i class="bi bi-person-badge-fill"></i></th>
                        <th style="width: 25%;"><i class="bi bi-person-badge-fill"></i></th>
                        <th style="width: 25%;"><i class="bi bi-person-badge-fill"></i></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var day in Model.weekdays)
                    {
                        <tr class="border-top">
                            <td class="bg-light text-center">
                                <h5 class="status-th">@day</h5>
                            </td>
                            @foreach (var group in Model.Schedule)
                            {
                                if (@group.Key == day)
                                {
                                    @foreach (var waiter in group)
                                    {
                                        <td class="text-center">
                                            <form asp-page-handler="account" method="post">
                                                <button class="btn-waiter name-color">@waiter.FirstName</button>
                                                <input type="hidden" name="name" value="@waiter.FirstName">
                                            </form>
                                        </td>
                                    }
                                }
                            }
                        </tr>
                    }
                </tbody>
            </table>
        }

        <form asp-page-handler="clear" method="post"
            onclick="return confirm('Are you sure you want to clear schedule')">
            <button class="btn btn-danger">Clear Schedule</button>
        </form>

    </div>
</div>


